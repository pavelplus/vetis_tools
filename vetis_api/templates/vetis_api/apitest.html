{% extends 'main/base.html' %}

{% block content %}
  <h1>Песочница Ветис.API</h1>
  {% for header_key, header_value in headers.items %}
    {% if forloop.first %}
      <h3>Headers</h3>
      <ul class="list-group">
    {% endif %}
    <li class="list-group-item">
      <span class="badge text-bg-secondary">{{ header_key }}</span> {{ header_value }}
    </li>
    {% if forloop.last %}
      </ul>
    {% endif %}
  {% endfor %}

  {% if body %}
    <h3 class="mt-3">Body</h3>
    <textarea style="width: 100%; height: 500px;">{{ body }}</textarea>
  {% endif %}

  {% if soap_request %}
    <h3 class="mt-3">SOAP request</h3>
    <textarea style="width: 100%; height: 500px;">{{ soap_request }}</textarea>
  {% endif %}

  {% if response.status_code %}
    <h3 class="mt-3">Response</h3>
    <p>Status code: {{ response.status_code }}</p>
    <textarea style="width: 100%; height: 500px;">{{ response.text }}</textarea>
  {% endif %}

  {% if ref %}
    <h3 class="mt-3">Celery</h3>
    <p>{{ ref }}</p>
  {% endif %}
  <hr />
  <form action="{% url 'vetis_api:apitest' %}" method="post">
    {% csrf_token %}
    <button class="btn btn-primary" name="send_test_task" value="1" type="submit">Тестовая задача для celery</button>
    <button class="btn btn-primary" name="test" value="1" type="submit">Test</button>
  </form>
  {% if request.GET.task_id %}
    <div hx-get="{% url 'vetis_api:task_info' %}?task_id={{ request.GET.task_id }}" hx-trigger="load, every 1s"></div>
  {% endif %}
{% endblock %}
