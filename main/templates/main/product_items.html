{% extends 'main/base.html' %}

{% block content %}
  {% load django_bootstrap5 %}
  <div class="d-flex justify-content-between align-items-end">
    <h3 class="mt-3">Наименования продукции</h3>
    <form method="POST" action="{% url 'main:vetis_task' %}">
      {% csrf_token %}
      <div class="dropdown">
        <button class="btn btn-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi bi-gear"></i></button>
        <ul class="dropdown-menu">
          <li>
            <button class="dropdown-item" name="vetis_task" value="reload_product_items"
              onclick="return window.confirm('Будут загружены данные с сайта Ветис. Вы уверены?')">
              Загрузить (обновить) справочник наименований
            </button>
          </li>
          <li>
            <button class="dropdown-item" name="vetis_task" value="reload_product_subproduct"
              onclick="return window.confirm('Будут загружены данные с сайта Ветис. Вы уверены?')">
              Обновить справочники продукции и видов продукции
            </button>
          </li>
        </ul>
      </div>
    </form>
  </div>

  <form method="POST" name="search_form">
    {% csrf_token %}
    <div class="row align-items-end">
      {% bootstrap_field form.business_entity wrapper_class='col-lg-5 mb-3 mb-lg-0' %}
      {% bootstrap_field form.search_query wrapper_class='col-lg-4 mb-3 mb-lg-0' %}
      <div class="col-lg-3">
        <button class="btn btn-primary" name="search" type="submit">Применить</button>
      </div>
    </div>
  </form>
  <hr />
  {% for product_item in product_items %}
    {% if forloop.first %}
      <table class="table table-striped">
        <thead>
          <tr>
            <th scope="col">Наименование</th>
            <th scope="col">Тип продукции</th>
            <th scope="col">ГОСТ</th>
            <th scope="col">Производитель</th>
          </tr>
        </thead>
        <tbody>
    {% endif %}
          <tr>
            <td><a class="link-underline link-underline-opacity-0 link-underline-opacity-100-hover" href="{% url 'main:product_item_detail' product_item.id %}">{{ product_item.name }}</a></td>
            <td>{{ product_item.get_product_type_display }}</td>
            {% if product_item.is_gost %}
            <td>{{ product_item.gost }}</td>
            {% else %}
            <td>-</td>
            {% endif %}
            <td>{{ product_item.producer }}</td>
          </tr>
    {% if forloop.last %}
        </tbody>
      </table>
    {% endif %}
    {% empty %}
    <div class="alert alert-info mt-3" role="alert">Нет записей...</div>
  {% endfor %}
{% endblock %}
